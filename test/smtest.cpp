// gmssla.cpp: 定义应用程序的入口点。
//

#include "../gm/gm.h"
#include "strutil.h"

int main()
{
    int ret = 0;

    unsigned char msg[] = { 0x11,0x22,0x33,0x44,0x55,0x66,0x77,0x88,0x99,0x00,0xAA,0xBB,0xCC,0xDD,0xEE,0xFF };
    int msg_len = sizeof(msg);
    unsigned char digest[32] = { 0 };
    gm_sm3(msg, msg_len, digest);
    printx(digest, SM3_DIGEST_LENGTH, "sm3:");
    unsigned char iv[] = { 0x30,0x31,0x32,0x33,0x34,0x35,0x36,0x37,0x38,0x39,0x3A,0x3B,0x3C,0x3D,0x3E,0x3F };
    gm_sm3_hmac(msg, msg_len, iv, sizeof(iv), digest);
    printx(digest, SM3_DIGEST_LENGTH, "sm3_hmac:");

    unsigned char sm4_key[] = { 0x30,0x31,0x32,0x33,0x34,0x35,0x36,0x37,0x38,0x39,0x3A,0x3B,0x3C,0x3D,0x3E,0x3F };
    unsigned char sm4_iv[] = { 0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08 };
    unsigned char plain[] = { 0x11,0x22,0x33,0x44,0x55,0x66,0x77,0x88,0x99,0x00,0xAA,0xBB,0xCC,0xDD,0xEE,0xFF  ,
                              0x11,0x22,0x33,0x44,0x55,0x66,0x77,0x88,0x99,0x00,0xAA,0xBB,0xCC,0xDD,0xEE,0xFF  ,
                              0x11,0x22,0x33,0x44,0x55,0x66,0x77,0x88,0x99,0x00,0xAA,0xBB,0xCC,0xDD,0xEE,0xFF, 0x00, 0xFF, 0x00, 0x00 };
    size_t plain_len = sizeof(plain);
    size_t len = sizeof(plain);

    unsigned char cipher[128] = { 0 };
    size_t cipher_len = sizeof(cipher);
    gm_sm4_ecb_encrypt(plain, cipher, sm4_key, 1);
    printx(cipher, sizeof(plain), "sm4 ecb ciphertext:");

    unsigned char plaintext[128] = { 0 };
    gm_sm4_ecb_encrypt(cipher, plaintext, sm4_key, 0);
    printx(plaintext, sizeof(plain), "sm4 ecb plaintext:");

    gm_sm4_cbc_encrypt(plain, cipher, sizeof(plain), sm4_key, sm4_iv, 1);
    printx(cipher, sizeof(plain), "sm4 cbc ciphertext:");

    //unsigned char cipher1[] = { 0x2d,0x79,0xef,0x92,0x5a,0x4a,0xc2,0x69,0x25,0x8f,0x97,0x36,0xa6,0xeb,0x68,0x76,0xce,0x1c,0xd7,0x6f,0x50,0x8b,0xcc,0x04,0x36,0x3b,0x72,0x1b,0x50,0x83,0x3a,0x86 };

    bzero(plaintext, sizeof(plaintext));
    gm_sm4_cbc_encrypt(cipher, plaintext, sizeof(plain), sm4_key, sm4_iv, 0);
    printx(plaintext, sizeof(plain), "sm4 cbc plaintext:");

    bzero(cipher, sizeof(cipher));
    gm_sm4(plain, cipher, &len, sm4_key, sm4_iv, 1, SGD_SM4_ECB, PADDING_PBOC);
    printx(cipher, len, "#### gm_sm4 ecb cipher:");

    bzero(plaintext, sizeof(plaintext));
    gm_sm4(cipher, plaintext, &len, sm4_key, sm4_iv, 0, SGD_SM4_ECB, PADDING_PBOC);
    printx(plaintext, len, "#### gm_sm4 ecb plaintext:");

    bzero(cipher, sizeof(cipher));
    len = sizeof(plain);
    gm_sm4(plain, cipher, &len, sm4_key, sm4_iv, 1, SGD_SM4_CBC, PADDING_PBOC);
    printx(cipher, len, "@@@@ gm_sm4 cbc cipher : ");

    bzero(plaintext, sizeof(plaintext));
    gm_sm4(cipher, plaintext, &len, sm4_key, sm4_iv, 0, SGD_SM4_CBC, PADDING_PBOC);
    printx(plaintext, len, "@@@@ gm_sm4 cbc plaintext:");

    unsigned char mmsg[] = { 0x01,0x03,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xFF,0xFF,0x01,0x37,0x00,0x10,0xFA,0x9F,0x9E,0x78,0xC4,0x93,0x54,0xC6,0xAA,0xBB,0xFF,0xFF,0x01,0x37,0x00,0x10,0xFA,0x9F,0x9E,0x78,0xC4,0x93,0x54,0xC6,0xAA,0xBB,0x36,0x8E,0x81,0xE7,0xAC,0xB2,0x41,0x08,0xB0,0xCA,0x7C,0x01,0x48,0xBF,0x82,0xF3,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xA3,0xC0,0x01,0xB0,0x00,0x00,0x00,0x79,0x00,0x00,0x04,0x01,0x00,0x00,0x00,0x10,0x04,0x99,0xF4,0x80,0x4E,0x30,0x0C,0xD2,0xCF,0xE4,0xDB,0x05,0xEF,0x23,0xFA,0x86,0x61,0xB5,0xF3,0x2E,0x46,0x1F,0xD6,0x4F,0xD0,0x9C,0x43,0xBB,0xE9,0x19,0xA5,0xB8,0x50,0x3B,0xFF,0xE8,0x36,0xB8,0x63,0xF8,0x26,0x28,0xC5,0xEE,0x39,0x04,0x72,0x3F,0x88,0x08,0x6B,0xA4,0xD3,0xE8,0x10,0x94,0xD1,0xF2,0x1B,0xBE,0xD8,0x8B,0xF5,0x25,0xD5,0xF3,0xAB,0xB4,0x05,0xAE,0xD8,0x44,0xC0,0xE2,0xDF,0x0F,0xD8,0x9D,0xDC,0xF7,0xFE,0xB6,0xBA,0x02,0x2A,0x89,0xDC,0x37,0xC0,0x77,0xCE,0x61,0xDF,0x4E,0x4C,0x6A,0x09,0xF4,0x84,0xD0,0xE8,0xB1,0x88,0x7D,0xD8,0xC0,0x52,0x3D,0x1C,0xFB,0xCF,0x82,0x85 };
    int mmsg_len = sizeof mmsg;
    unsigned char iiv[] = { 0x5F,0xAF,0x49,0x48,0x33,0x5D,0xE6,0xFB,0x0F,0xEE,0xD2,0x05,0x63,0xE3,0xE3,0x62 };
    gm_sm3_hmac(mmsg, mmsg_len, iiv, sizeof(iiv), digest);
    printx(digest, SM3_DIGEST_LENGTH, "sm3_hmac2:");

    return ret;
}